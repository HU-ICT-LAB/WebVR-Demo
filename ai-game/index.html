<html>
<head>
    <title> {test} AFrameBasics Project</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.0.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.0.1/dist/aframe-event-set-component.js"></script>
    <script src="https://unpkg.com/aframe-aabb-collider-component@3.1.0/dist/aframe-aabb-collider-component.min.js"></script>

    <script>

        let scoreagaindelay = 0;
        setInterval(function() {
            if (scoreagaindelay == 0) clearInterval(this);
            else console.log('Currently at ' + (scoreagaindelay--));
        }, 1000);


        AFRAME.registerComponent('hit', {

            init: function () {

                this.el.addEventListener('hitstart', function(){
                    var scorenumber = document.querySelector("#score");

                    console.log("Item touched");
                    this.setAttribute('color', "#FF0000");
                    var currentscore = scorenumber.getAttribute('text').value;
                    console.log(currentscore);
                    if (scoreagaindelay === 0) {
                        scorenumber.setAttribute('text', 'value', +currentscore + 1);
                        scoreagaindelay = 1;
                    }
                })
                this.el.addEventListener('hitend', function(){
                    console.log("Item exited");
                    this.setAttribute('color', "#333333");
                })

            }
        });
    </script>
    <script>
        AFRAME.registerComponent("hitbox", {
            init: function() {
                let body = document.createElement("a-box");
                let head = document.createElement("a-box");

                body.setAttribute("position", "0 110 0");
                body.setAttribute("mixin", "body");
                head.setAttribute("position", "0 70 0");
                head.setAttribute("mixin", "head");
                body.appendChild(head)

                this.el.appendChild(body);

            }
        })

        AFRAME.registerPrimitive("a-hitbox", {
            defaultComponents: {
                hitbox: {}
            }
        })

    </script>


</head>
<body>
<a-scene>
    <!-- Assets -->
    <a-assets>
        <img id="floor" src="assets/textures/Carpet.jpg">
        <img id="Sky" src="assets/textures/background.jpg">
        <img id="Metal" src="assets/textures/Metal.png">
        <a-asset-item id="Robot" src="assets\models\Robot_gltf/scene.gltf"></a-asset-item>
        <a-mixin id="head" geometry="primitive:box; height:50; width:40; depth:30;" material="opacity: 1.0; transparent: true" ></a-mixin>
        <a-mixin id="body" geometry="primitive:box; height:70; width:60; depth:55;" material="opacity: 1.0; transparent: true" handle-events aabb-collider></a-mixin>



    </a-assets>
     ScoreBoard
                <a-box color="#FFFFFF" src=#Metal width="3" height="1.5" depth="0.1" position="0 4 -6">
                    <a-circle color="#333333" side="double" position="1.3 0 0.08" radius="0.2"> </a-circle>
                    <a-circle color="#333333" side="double" position="-1.3 0 0.08" radius="0.2"> </a-circle>
                    <a-box color="#FFFFFF" src=#Metal width="10" height="0.5" depth="0.1" position="0 1 0" repeat="10 1"></a-box>
                    <a-box color="#333333" src=#Metal width="8" height="0.5" depth="0.5" rotation="0 0 90" position="5.25 -2.25 0"></a-box>
                    <a-box color="#333333" src=#Metal width="8" height="0.5" depth="0.5" rotation="0 0 90" position="-5.25 -2.25 0"></a-box>
                    <a-text id="score" value= "0" position="-0.85 0.2 0.08" scale="10 10 10"> </a-text>
                    <a-box id="Highscoreboard" color="#A9A9A9" src=#Metal width="1.5" height="3" depth="0.1" position="-4 -0.75 0"  repeat="10 1">
                        <a-entity id="Highscoretext" text="value: ++++++++++; color: #FFFFFF" position="1.75 0 0.11" scale="5 5 5" sethighscore></a-entity>
                    </a-box>
                </a-box>
<!--    <a-text id="score" value= "0" position="0 5 -5.7" scale="10 10 10"> </a-text>&ndash;&gt;-->


    <!-- Sky -->
    <a-sky src="#Sky"
           radius="10"
           side="double">
    </a-sky>

    <!-- Arena -->
    <a-cylinder radius="2.75" height="4" color="#FFC65D" segments-radial="6" open-ended="True" side="double" position="0 -1 0" rotation="0 0 0" animation="property: position; from:0 -3 0; to: 0 0 0; repeat:indefinite; direction:alternate; dur: 7000; easing:linear"></a-cylinder>


    <!-- Floor -->
    <a-plane material="color: #FFFFFF; src: #floor; repeat: 5 5;"
             rotation="-90 0 0"
             scale="20 20 1"
             position="0 -0.1 0">
    </a-plane>




    <!--             Robot Playermodel-->
    <a-entity gltf-model="#Robot" scale="0.007 0.01 0.01" position="0 0 -1"
              animation="property: position; from: 0 0 -1; to: 0 0 0; dur: 10000; easing: linear">
<!--        <a-box id="bodyhitbox" color="#333333" width="60" height="80" depth="55" position="0 110 0"-->
<!--               handle-events aabb-collider></a-box>-->


        <a-hitbox color="#333333" position="0 2 0" ></a-hitbox>
    </a-entity>


<!--    Camera and Oculus rift-->
    <a-entity wasd-controls id="rig" position="0 0 2">
        <a-entity id="camera" camera look-controls ></a-entity>
        <a-entity id="lefthand" aabb-collider="objects: a-box" oculus-touch-controls="hand: left" thumbstick-logging hit></a-entity>
        <a-entity id="righthand" aabb-collider="objects: a-box" oculus-touch-controls="hand: right" thumbstick-logging hit></a-entity>
    </a-entity>

</a-scene>
</body>

</html>
